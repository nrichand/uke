<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
        <title>Uke site</title>

        <script src="https://unpkg.com/prismic.io@2.0.0/dist/prismic.io.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>

        <script src="js/prismic-configuration.js"></script>
        <script src="js/prismic-helpers.js"></script>
	</head>
    <body>
    	<h1>Welcome</h1>
    	<h2>List of songs :</h2>

    	<ul>
	    	<div class="text-center"  id="listSongs">
	            <script id="song-template" type="text/x-handlebars-template">
	                {{#each this}}
	                	<li>
		                    <a href="song.html?id={{id}}&slug={{slug}}">
		                    	{{data.[uke-song.name].value}}
		                    </a>
	                    </li>
	                {{/each}}
	            </script>
	        </div>
	    </ul>

    	<script src="http://static.cdn.prismic.io/prismic.js"></script>
    	<script type="text/javascript">
            $(function() {
                Helpers.withPrismic(function(ctx) {
                    ctx.api.form("everything").set('page', parseInt(window.location.hash.substring(1)) || 1 ).ref(ctx.ref).submit(function(err, docs) {
                        if (err) { Configuration.onPrismicError(err); return; }
                        // Feed the templates
                        console.log(docs.results);

                        var songs = $("#song-template").html();
                        var song_template = Handlebars.compile(songs);

                        $("#listSongs").html(song_template(docs.results))                
                    });
                });
            });
        </script>
    </body>
</html>